<?php 
    require_once "conexion.php";
   
$alert ='';
session_start();
if (!empty($_SESSION['active'])) {
    header('location:home.php');
}else{
if (!empty($_POST)) {
    if (empty($_POST['txtuser']) || empty($_POST['txtpass'])) {
        $alert ="Ingrese su usuario y clave";
    }else{
        $user = addslashes(trim($_POST['txtuser']));
        $pass = $_POST['txtpass'];

        $query = mysqli_query($objConexion,"SELECT * FROM Usuario WHERE Usuario = '$user' AND Clave = '$pass'");
        $result = mysqli_num_rows($query);

        if ($result > 0) {
            $data = mysqli_fetch_array($query);
           // $sql="SELECT usuario.idUsuario,usuario.Nombre,usuario.ApellidoP,
            //            usuario.ApellidoM,usuario.Correo,usuario.Usuario,usuario.Clave,
             //           rol.Rol From usuario INNER JOIN rol  ON usuario.Rol_idRol = rol.idRol";
           //$dat = mysqli_fetch_array($sql);            
            //para imprimir lo que trae un array  ... print_r($data);

            $_SESSION['active'] = true;
            $_SESSION['idUsuario'] = $data['idUsuario'];
            $_SESSION['Nombre'] = $data['Nombre'];
            $_SESSION['ApellidoP'] = $data['ApellidoP'];
            $_SESSION['ApellidoM'] = $data['ApellidoM'];
            $_SESSION['Usuario'] = $data['Usuario'];
            $_SESSION['Clave'] = $data['Clave'];
            
            header('location:home.php');
        }else{
            $alert ='<p class="msg_error">"El usuario o la clave son incorrectas"</p>';
            session_destroy();
        }

    }
 }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="author" content="Muhamad Nauval Azhar">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<meta name="description" content="This is a login page template based on Bootstrap 5">
	<title>Noticias</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="css/login.css" th:href="@{/css/login.css}">
	<link href="paginador.css" rel="stylesheet">
</head>

<body>
	<section class="h-100">
		<div class="container h-100">
			<div class="row justify-content-sm-center h-100">
				<div class="col-xxl-4 col-xl-5 col-lg-5 col-md-7 col-sm-9">
					<div class="text-center my-5">
						<img src="imagenes/ITFC.png" alt="logo" width="100">
					</div>
					<div class="card shadow-lg">
						<div class="card-body p-5">
							<h1 class="fs-4 card-title fw-bold mb-4">Inicio de sesi√≥n</h1>
							<form method="POST" action="" class="needs-validation" novalidate="" autocomplete="off">
								<div class="mb-3">
									<label class="mb-2 text-muted" for="email">Usuario</label>
									<input type="text" class="form-control" value="" name="txtuser" id="txtuser" required autofocus>
								</div>

								<div class="mb-3">
									<div class="mb-2 w-100">
										<label class="text-muted" for="password">Clave</label>
									</div>
									<input type="password" class="form-control" name="txtpass" id="txtpass" required>
								    
								</div>
								<label class="alert"><?php echo isset($alert)?$alert : ''?></label>
								<div class="d-flex align-items-center">
									<button type="submit" class="btn btn-primary ms-auto">
										Ingresar
									</button>
								</div>
							</form>
						</div>
						
					</div>
					<div class="text-center mt-5 text-muted">
					
					</div>
				</div>
			</div>
		</div>
	</section>

	<script src="js/login.js"></script>
</body>
</html>
